# BF損益計算

## 概要
bitFlyerのExcel形式専用の移動平均簿価と売買損益の計算ツールです。

## ※免責事項
あらかじめお断りさせていただきますが、計算結果等について作者は一切保証はいたしません。
このツールの計算結果をもとに申告等をされる場合はすべて自己責任でおこなってください。

## はじめに
仮想通貨に関する税金については国税庁のページ(PDF)に説明がありますのでご確認ください。
https://www.nta.go.jp/shiraberu/zeiho-kaishaku/joho-zeikaishaku/shotoku/shinkoku/171127/01.pdf

ハイパーインフレに備えてコツコツ積み立ててガチホするつもりだったのですが、BTCの暴騰時にリバランスしようと仮想通貨間でスイッチングしたら申告不要限度を超えてしまい、泣く泣く計算ツールを作りました。

国税庁のPDFにあるルールに沿って金額を算出するように作ったつもりですが、理解の誤りやプログラムの誤りなどがあったりするかもしれませんので、各自で最終確認してください。

## 機能
- bitFlyerからダウンロードした取引履歴をもとに、各取引後の移動平均簿価と取引ごとの損益を計算します。
- BTC,ETH,BCHの現物のみに対応しています。(fxはExcelファイルに損益まで載っているのでそれを使ってください)
- ライトコインには対応していません。
- ウォレットや他取引所からの入庫には対応していません。
- 出庫は時価で売却したとみなして損益を計算しています。
- FXの現引き、現渡しには対応していません。

## 使い方
### 前準備
1. bitFlyerから取引履歴のExcelをダウンロードしてください
1. 取引履歴をExcelで開いてCSV形式で保存しなおしてください

### ツールの使用
1. 本ツールを起動して「価格データを取得して保存...」を押し、保存ダイアログでファイル名を指定して保存してください。cryptowatchから日足データを取得してCSV形式で保存します。
1. 「取引履歴CSVをロード...」を押し、オープンダイアログでさきに保存した取引履歴CSVを指定して開いてください。
1. 「価格データをロード...」を押し、オープンダイアログでさきに保存した日足データを指定して開いてください。
1. 「移動平均と売買損益を計算...」を押し、保存ダイアログでファイル名を指定して保存してください。

### エクセル上での処理
1. さきに保存した「移動平均と売買損益のCSVファイル」を開いてください。
1. セル幅が狭かったり、表示が指数形式だったりするところは適宜レイアウトを調整してください。
1. G,H,I列がその行の取引についての損益(円)ですのでこれらの列の2017/1/1～12/31分を合計すると現物取引の年間損益になるはずです。

## その他
- D,E,F列はその行の取引をした時点での終値です(終値の定義は謎です、cryptowatchのapiでインターバル86400秒を指定して取得した4本値のClose値を採用しています)。
- 簿価と残数量は載せていますが簿価単価は載せていません(全部売りなどのときに簿価が発散しそうなので...)。
- 出庫は売却とみなしていますが「まだ実現してないよ」という場合は適宜修正してください。(でも、複数の取引所で並行して取引している場合にどう計算するかは謎なんですけど...)
- 今回作ったものには簿価と残高を初期値として設定する機能はありませんが、来年以降どうするか未定です。

ソースもおきますので改造のベースにどうぞ(MITライセンスです)

バグ報告などいただけるようでしたらGitHubかブログまでお願いします。

20180119 けろけろ
